<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGCD Dynamic Prioritization - Dynamics 365</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .controls button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            transition: background 0.3s;
        }

        .controls button:hover {
            background: #5568d3;
        }

        .controls button.pause {
            background: #f59e0b;
        }

        .controls button.pause:hover {
            background: #d97706;
        }

        .config-panel {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .config-panel h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 18px;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .config-group {
            display: flex;
            flex-direction: column;
        }

        .config-group label {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .config-group input {
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .config-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .config-divider {
            grid-column: 1 / -1;
            height: 1px;
            background: #e5e7eb;
            margin: 10px 0;
        }

        .fifo-badge {
            background: #8b5cf6;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 8px;
        }

        .queue.fifo {
            border: 2px solid #8b5cf6;
        }

        .fifo-position {
            font-size: 20px;
            font-weight: bold;
            color: #8b5cf6;
        }

        .wait-time-warning {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            animation: warningPulse 2s infinite;
        }

        .wait-time-critical {
            background: #fee2e2;
            border: 2px solid #ef4444;
            animation: criticalPulse 1s infinite;
        }

        @keyframes warningPulse {
            0%, 100% {
                border-color: #f59e0b;
            }
            50% {
                border-color: #fbbf24;
            }
        }

        @keyframes criticalPulse {
            0%, 100% {
                border-color: #ef4444;
            }
            50% {
                border-color: #f87171;
            }
        }

        .starvation-indicator {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 5px;
        }

        .starvation-indicator.warning {
            background: #fbbf24;
            color: #78350f;
        }

        .starvation-indicator.critical {
            background: #ef4444;
            color: white;
        }

        .stats-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .stats-panel h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .stat-card {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ddd;
        }

        .stat-card.diamond {
            border-left-color: #3b82f6;
        }

        .stat-card.gold {
            border-left-color: #f59e0b;
        }

        .stat-card.yellow {
            border-left-color: #eab308;
        }

        .stat-card.standard {
            border-left-color: #6b7280;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .stat-subtext {
            font-size: 11px;
            color: #999;
            margin-top: 3px;
        }

        .add-customer-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .add-customer-panel h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .add-customer-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .add-customer-controls select {
            padding: 10px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 5px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .add-customer-controls select:focus {
            outline: none;
            border-color: #667eea;
        }

        .controls button.danger {
            background: #ef4444;
        }

        .controls button.danger:hover {
            background: #dc2626;
        }

        .controls button.success {
            background: #10b981;
        }

        .controls button.success:hover {
            background: #059669;
        }

        .scenario-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .scenario-panel h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .scenario-description {
            background: #f0f9ff;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
            margin-bottom: 15px;
            font-size: 14px;
            line-height: 1.6;
            color: #1e3a8a;
        }

        .scenario-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .scenario-progress {
            background: #f9fafb;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 13px;
            color: #666;
            display: none;
        }

        .scenario-progress.active {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            margin-top: 8px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        .summary-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .summary-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .summary-content {
            background: white;
            border-radius: 10px;
            padding: 30px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        .summary-header h2 {
            color: #333;
            font-size: 24px;
        }

        .close-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .close-btn:hover {
            background: #dc2626;
        }

        .summary-section {
            margin-bottom: 25px;
        }

        .summary-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-box {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .metric-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .metric-value {
            font-size: 28px;
            font-weight: bold;
            color: #333;
        }

        .metric-subtext {
            font-size: 11px;
            color: #999;
            margin-top: 3px;
        }

        .tier-analysis {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .tier-analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .tier-analysis-title {
            font-weight: bold;
            font-size: 16px;
        }

        .tier-analysis-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            font-size: 13px;
        }

        .served-indicator {
            background: #10b981;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 5px;
        }

        .agent-assignment {
            background: #e0e7ff;
            border: 2px dashed #667eea;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            color: #667eea;
            font-weight: bold;
        }

        .queue-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .queue {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .queue-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .queue-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .queue-count {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .conversation {
            background: #f9fafb;
            border-left: 4px solid #ddd;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .conversation.diamond {
            border-left-color: #3b82f6;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        }

        .conversation.gold {
            border-left-color: #f59e0b;
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
        }

        .conversation.yellow {
            border-left-color: #eab308;
            background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%);
        }

        .conversation.standard {
            border-left-color: #6b7280;
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
        }

        .conversation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .customer-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .customer-name {
            font-weight: bold;
            color: #333;
        }

        .tier-badge {
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .tier-badge.diamond {
            background: #3b82f6;
            color: white;
        }

        .tier-badge.gold {
            background: #f59e0b;
            color: white;
        }

        .tier-badge.yellow {
            background: #eab308;
            color: white;
        }

        .tier-badge.standard {
            background: #6b7280;
            color: white;
        }

        .priority-score {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .conversation-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 13px;
            color: #666;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 11px;
            text-transform: uppercase;
            color: #999;
            margin-bottom: 3px;
        }

        .detail-value {
            font-weight: 600;
            color: #333;
        }

        .legend {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .legend h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f9fafb;
            border-radius: 5px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 5px;
        }

        .legend-color.diamond {
            background: #3b82f6;
        }

        .legend-color.gold {
            background: #f59e0b;
        }

        .legend-color.yellow {
            background: #eab308;
        }

        .legend-color.standard {
            background: #6b7280;
        }

        .legend-text {
            flex: 1;
        }

        .legend-title {
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }

        .legend-desc {
            font-size: 12px;
            color: #666;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .conversation.updated {
            animation: pulse 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AGCD Dynamic Prioritization System</h1>
            <p>Real-time conversation prioritization using Natural Language Powered Agentic Conversation Distribution for Dynamics 365</p>
        </div>

        <div class="config-panel">
            <h3>‚öôÔ∏è Configuration Settings</h3>
            <div style="background: #eff6ff; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-size: 13px; border-left: 3px solid #3b82f6;">
                <strong>üí° How to use:</strong> You can manually adjust any values below and click "Apply Custom Config" in the Automated Simulation Scenarios section, or use one of the preset configurations.
            </div>
            <div class="config-grid">
                <div class="config-group">
                    <label>Time Interval (seconds)</label>
                    <input type="number" id="timeInterval" value="10" min="1" max="300">
                </div>

                <div class="config-divider"></div>

                <div class="config-group">
                    <label>Diamond Base Priority</label>
                    <input type="number" id="diamondBase" value="0" min="0" step="1">
                </div>
                <div class="config-group">
                    <label>Diamond Score Increase</label>
                    <input type="number" id="diamondIncrease" value="15" min="0" step="1">
                </div>

                <div class="config-group">
                    <label>Gold Base Priority</label>
                    <input type="number" id="goldBase" value="0" min="0" step="1">
                </div>
                <div class="config-group">
                    <label>Gold Score Increase</label>
                    <input type="number" id="goldIncrease" value="11" min="0" step="1">
                </div>

                <div class="config-group">
                    <label>Yellow Base Priority</label>
                    <input type="number" id="yellowBase" value="0" min="0" step="1">
                </div>
                <div class="config-group">
                    <label>Yellow Score Increase</label>
                    <input type="number" id="yellowIncrease" value="9" min="0" step="1">
                </div>

                <div class="config-group">
                    <label>Standard Base Priority</label>
                    <input type="number" id="standardBase" value="0" min="0" step="1">
                </div>
                <div class="config-group">
                    <label>Standard Score Increase</label>
                    <input type="number" id="standardIncrease" value="8" min="0" step="1">
                </div>
            </div>
        </div>

        <div class="scenario-panel">
            <h3>üé¨ Automated Simulation Scenarios</h3>
            <div class="scenario-description">
                <strong>üéØ Clear Differentiation Demo (Queue 1 Focus)</strong><br>
                Watch a realistic scenario where:<br>
                ‚Ä¢ <strong>Standard customers arrive first</strong> (0-20s) and build up wait time<br>
                ‚Ä¢ <strong>Diamond customers arrive late</strong> (40s+) but should still get priority<br>
                ‚Ä¢ <strong>All 22 customers go to Q1</strong> for easy visualization<br>
                <em>Goal: Showcase Diamond priority power while minimizing starvation!</em>
            </div>
            <div class="scenario-buttons">
                <button id="applyBalancedConfig" class="success">‚úÖ Config: Strong Priority (15,11,7,5)</button>
                <button id="applyOptionA" class="success">‚úÖ Config: Option A (15,11,9,8)</button>
                <button id="applyCustomConfig" class="success">‚úÖ Apply Custom Config</button>
                <button id="runBalancedScenario">‚ñ∂Ô∏è Run Simulation</button>
                <button id="stopScenarioBtn" class="danger" style="display: none;">‚èπÔ∏è Stop Scenario</button>
            </div>
            <div style="margin-top: 10px; font-size: 12px; color: #666; background: #f9fafb; padding: 10px; border-radius: 5px;">
                <strong>Config Guide:</strong><br>
                ‚Ä¢ <strong>Strong Priority (15,11,7,5):</strong> 3x Diamond advantage - Maximum showcase of power<br>
                ‚Ä¢ <strong>Option A (15,11,9,8):</strong> 1.875x Diamond advantage - Diamond ~48-50% faster, zero starvation (Recommended)<br>
                ‚Ä¢ <strong>Custom Config:</strong> Set your own values in the Configuration Settings above, then click "Apply Custom Config"<br>
                ‚Ä¢ <strong>Agent Assignment:</strong> Every 10 seconds for faster processing and lower wait times
            </div>
            <div class="scenario-progress" id="scenarioProgress">
                <div id="scenarioStatus">Preparing simulation...</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
        </div>

        <div class="add-customer-panel">
            <h3>‚ûï Manual Customer Addition</h3>
            <div class="add-customer-controls">
                <select id="selectQueue">
                    <option value="Q1">Queue 1 (Q1) - Priority</option>
                    <option value="Q2">Queue 2 (Q2) - Priority</option>
                    <option value="Q3">Queue 3 (Q3) - FIFO</option>
                </select>
                <select id="selectTier">
                    <option value="Diamond">Diamond Tier</option>
                    <option value="Gold">Gold Tier</option>
                    <option value="Yellow">Yellow Tier</option>
                    <option value="Standard">Standard Tier</option>
                </select>
                <button id="addCustomerBtn">‚ûï Add Customer</button>
                <button id="addRandomBtn">üé≤ Add Random</button>
            </div>
        </div>

        <div class="controls">
            <button id="pauseBtn" class="pause">‚è∏Ô∏è Pause Simulation</button>
            <button id="stopSimulationBtn" class="danger">‚èπÔ∏è Stop & Show Summary</button>
            <button id="clearAllBtn" class="danger">üóëÔ∏è Clear All Queues</button>
            <button id="resetBtn">üîÑ Reset with Sample Data</button>
        </div>

        <div class="agent-assignment" id="agentAssignment">
            ü§ñ Auto-assigning top customers to agents every 10 seconds...
        </div>

        <div class="stats-panel">
            <h3>üìä Queue Statistics & Starvation Prevention</h3>
            <div class="stats-grid" id="statsGrid">
                <!-- Stats will be populated by JavaScript -->
            </div>
        </div>

        <div class="queue-container">
            <div class="queue" id="q1">
                <div class="queue-header">
                    <span class="queue-title">Queue 1 (Q1)</span>
                    <span class="queue-count">0 waiting</span>
                </div>
                <div class="queue-content" id="q1-content"></div>
            </div>

            <div class="queue" id="q2">
                <div class="queue-header">
                    <span class="queue-title">Queue 2 (Q2)</span>
                    <span class="queue-count">0 waiting</span>
                </div>
                <div class="queue-content" id="q2-content"></div>
            </div>

            <div class="queue fifo" id="q3">
                <div class="queue-header">
                    <div>
                        <span class="queue-title">Queue 3 (Q3)</span>
                        <span class="fifo-badge">FIFO</span>
                    </div>
                    <span class="queue-count">0 waiting</span>
                </div>
                <div class="queue-content" id="q3-content"></div>
            </div>
        </div>

        <div class="legend">
            <h3>Prioritization Logic</h3>
            <div class="legend-grid" id="legendGrid">
                <div class="legend-item">
                    <div class="legend-color diamond"></div>
                    <div class="legend-text">
                        <div class="legend-title">Diamond Tier</div>
                        <div class="legend-desc">+1000 points per 30s</div>
                    </div>
                </div>
                <div class="legend-item">
                    <div class="legend-color gold"></div>
                    <div class="legend-text">
                        <div class="legend-title">Gold Tier</div>
                        <div class="legend-desc">+900 points per 30s</div>
                    </div>
                </div>
                <div class="legend-item">
                    <div class="legend-color yellow"></div>
                    <div class="legend-text">
                        <div class="legend-title">Yellow Tier</div>
                        <div class="legend-desc">+800 points per 30s</div>
                    </div>
                </div>
                <div class="legend-item">
                    <div class="legend-color standard"></div>
                    <div class="legend-text">
                        <div class="legend-title">Standard Tier</div>
                        <div class="legend-desc">+400 points per 30s</div>
                    </div>
                </div>
            </div>
            <div style="margin-top: 20px; padding: 15px; background: #f3f4f6; border-radius: 5px; border-left: 4px solid #8b5cf6;">
                <strong style="color: #8b5cf6;">Queue Logic:</strong>
                <div style="margin-top: 8px; font-size: 14px; color: #666;">
                    ‚Ä¢ <strong>Q1 & Q2:</strong> Priority-based routing - Highest priority score served first<br>
                    ‚Ä¢ <strong>Q3:</strong> FIFO (First In First Out) - Customers served in arrival order
                </div>
            </div>
            <div style="margin-top: 15px; padding: 15px; background: #ecfdf5; border-radius: 5px; border-left: 4px solid #10b981;">
                <strong style="color: #059669;">üõ°Ô∏è Configuration Strategy:</strong>
                <div style="margin-top: 8px; font-size: 13px; color: #065f46;">
                    <strong>Default: Option A (Recommended) - 15, 11, 9, 8</strong><br>
                    ‚Ä¢ <strong>All tiers start equal</strong> (Base: 0) - Fair starting point<br>
                    ‚Ä¢ <strong>Diamond gets 1.875x faster growth</strong> (+15 per 10s vs Standard +8 per 10s)<br>
                    ‚Ä¢ <strong>Clear tier separation</strong> - Demonstrates VIP priority effectively<br>
                    ‚Ä¢ <strong>Agent assignment every 10 seconds</strong> - Faster processing, lower wait times<br>
                    ‚Ä¢ <strong>Zero starvation</strong> - Eliminates critical wait times across all tiers<br>
                    ‚Ä¢ <strong>Key Balance:</strong> Diamond waiting 30s = 45 priority. Standard waiting 56s = 45 priority. Diamond gets ~48-50% faster service while Standards don't starve.<br>
                    ‚Ä¢ <strong>Custom Values:</strong> You can manually adjust values in Configuration Settings and apply them!
                </div>
            </div>
        </div>
    </div>

    <!-- Summary Modal -->
    <div class="summary-modal" id="summaryModal">
        <div class="summary-content">
            <div class="summary-header">
                <h2>üìä Simulation Summary Report</h2>
                <button class="close-btn" id="closeSummaryBtn">Close</button>
            </div>
            <div id="summaryBody">
                <!-- Summary content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Customer tier configuration - Option A (Recommended)
        // 1.875x advantage for Diamond (15 vs 8) - optimal showcase with zero starvation
        let TIER_CONFIG = {
            'Diamond': { multiplier: 15, basePriority: 0, class: 'diamond' },
            'Gold': { multiplier: 11, basePriority: 0, class: 'gold' },
            'Yellow': { multiplier: 9, basePriority: 0, class: 'yellow' },
            'Standard': { multiplier: 8, basePriority: 0, class: 'standard' }
        };

        let TIME_INTERVAL = 10; // seconds

        // Starvation thresholds (in seconds)
        const WAIT_TIME_WARNING = 60; // Show warning after 60 seconds
        const WAIT_TIME_CRITICAL = 120; // Show critical alert after 120 seconds

        const CUSTOMER_NAMES = [
            'Sarah Johnson', 'Michael Chen', 'Emily Rodriguez', 'David Kim',
            'Jessica Taylor', 'Christopher Lee', 'Amanda Martinez', 'Daniel Brown',
            'Lisa Anderson', 'James Wilson', 'Maria Garcia', 'Robert Thompson'
        ];

        const CONVERSATION_SUBJECTS = [
            'Billing inquiry', 'Technical support', 'Account update', 'Product information',
            'Service complaint', 'Feature request', 'Password reset', 'Order status',
            'Refund request', 'Subscription change'
        ];

        let conversations = [];
        let conversationIdCounter = 1;
        let isPaused = false;
        let simulationInterval;
        let agentAssignmentInterval;
        let servedCustomers = [];
        let simulationStartTime = Date.now();
        let totalCustomersAdded = 0;
        let scenarioRunning = false;
        let scenarioTimeout = null;
        let scenarioSteps = [];

        // Initialize with sample conversations
        function initializeConversations() {
            const queues = ['Q1', 'Q2', 'Q3'];
            const tiers = ['Diamond', 'Gold', 'Yellow', 'Standard'];

            // Add 2-3 conversations per queue
            for (let i = 0; i < 8; i++) {
                addConversation(
                    queues[Math.floor(Math.random() * queues.length)],
                    tiers[Math.floor(Math.random() * tiers.length)],
                    true // isInitialLoad = true for sample data
                );
            }
        }

        function addConversation(queue, tier = null, isInitialLoad = false) {
            if (!tier) {
                const tiers = ['Diamond', 'Gold', 'Yellow', 'Standard'];
                tier = tiers[Math.floor(Math.random() * tiers.length)];
            }

            const tierConfig = TIER_CONFIG[tier];
            const conversation = {
                id: conversationIdCounter++,
                customerName: CUSTOMER_NAMES[Math.floor(Math.random() * CUSTOMER_NAMES.length)],
                subject: CONVERSATION_SUBJECTS[Math.floor(Math.random() * CONVERSATION_SUBJECTS.length)],
                tier: tier,
                queue: queue,
                waitTime: isInitialLoad ? Math.floor(Math.random() * 120) : 0, // Start at 0 for new customers, random for initial load
                priorityScore: tierConfig.basePriority, // Base priority from config
                startTime: Date.now(),
                arrivalOrder: conversationIdCounter - 1, // For FIFO
                addedAt: Date.now()
            };

            conversations.push(conversation);
            totalCustomersAdded++;
            renderQueues();
        }

        function assignToAgent() {
            if (isPaused || conversations.length === 0) return;

            const queues = { Q1: [], Q2: [], Q3: [] };

            // Group conversations by queue
            conversations.forEach(conv => {
                if (queues[conv.queue]) {
                    queues[conv.queue].push(conv);
                }
            });

            // Sort and get top customer from each queue
            queues.Q1.sort((a, b) => b.priorityScore - a.priorityScore);
            queues.Q2.sort((a, b) => b.priorityScore - a.priorityScore);
            queues.Q3.sort((a, b) => a.arrivalOrder - b.arrivalOrder);

            let assignedCount = 0;

            // Assign top customer from each queue if available
            ['Q1', 'Q2', 'Q3'].forEach(queueName => {
                if (queues[queueName].length > 0) {
                    const topCustomer = queues[queueName][0];

                    // Record served customer
                    servedCustomers.push({
                        ...topCustomer,
                        servedAt: Date.now(),
                        totalWaitTime: topCustomer.waitTime,
                        queuePosition: conversations.filter(c => c.queue === queueName).indexOf(topCustomer) + 1
                    });

                    // Remove from queue
                    conversations = conversations.filter(c => c.id !== topCustomer.id);
                    assignedCount++;
                }
            });

            if (assignedCount > 0) {
                renderQueues();
            }
        }

        function calculatePriorityScore(conversation) {
            const tierConfig = TIER_CONFIG[conversation.tier];
            const waitTimeIntervals = Math.floor(conversation.waitTime / TIME_INTERVAL);
            return tierConfig.basePriority + (waitTimeIntervals * tierConfig.multiplier);
        }

        function updateConversations() {
            if (isPaused) return;

            conversations.forEach(conv => {
                conv.waitTime += 1; // Increase wait time by 1 second

                // Only update priority score for non-FIFO queues
                if (conv.queue !== 'Q3') {
                    conv.priorityScore = calculatePriorityScore(conv);
                }
            });

            renderQueues();
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function calculateStatistics() {
            const stats = {
                'Diamond': { count: 0, totalWait: 0, maxWait: 0, atRisk: 0 },
                'Gold': { count: 0, totalWait: 0, maxWait: 0, atRisk: 0 },
                'Yellow': { count: 0, totalWait: 0, maxWait: 0, atRisk: 0 },
                'Standard': { count: 0, totalWait: 0, maxWait: 0, atRisk: 0 }
            };

            conversations.forEach(conv => {
                const tierStats = stats[conv.tier];
                tierStats.count++;
                tierStats.totalWait += conv.waitTime;
                tierStats.maxWait = Math.max(tierStats.maxWait, conv.waitTime);

                if (conv.waitTime >= WAIT_TIME_CRITICAL) {
                    tierStats.atRisk++;
                }
            });

            return stats;
        }

        function updateStatistics() {
            const stats = calculateStatistics();
            const statsGrid = document.getElementById('statsGrid');

            statsGrid.innerHTML = Object.keys(TIER_CONFIG).map(tier => {
                const tierStats = stats[tier];
                const tierConfig = TIER_CONFIG[tier];
                const avgWait = tierStats.count > 0 ? Math.round(tierStats.totalWait / tierStats.count) : 0;

                let riskIndicator = '';
                if (tierStats.atRisk > 0) {
                    riskIndicator = `<div style="color: #ef4444; font-size: 11px; margin-top: 5px; font-weight: bold;">‚ö†Ô∏è ${tierStats.atRisk} at starvation risk!</div>`;
                }

                return `
                    <div class="stat-card ${tierConfig.class}">
                        <div class="stat-label">${tier} Tier</div>
                        <div class="stat-value">${tierStats.count}</div>
                        <div class="stat-subtext">Waiting in queues</div>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #e5e7eb;">
                            <div style="font-size: 12px; color: #666;">Avg Wait: <strong>${formatTime(avgWait)}</strong></div>
                            <div style="font-size: 12px; color: #666;">Max Wait: <strong>${formatTime(tierStats.maxWait)}</strong></div>
                        </div>
                        ${riskIndicator}
                    </div>
                `;
            }).join('');
        }

        function getStarvationClass(waitTime) {
            if (waitTime >= WAIT_TIME_CRITICAL) {
                return 'wait-time-critical';
            } else if (waitTime >= WAIT_TIME_WARNING) {
                return 'wait-time-warning';
            }
            return '';
        }

        function getStarvationIndicator(waitTime) {
            if (waitTime >= WAIT_TIME_CRITICAL) {
                return '<span class="starvation-indicator critical">CRITICAL</span>';
            } else if (waitTime >= WAIT_TIME_WARNING) {
                return '<span class="starvation-indicator warning">AT RISK</span>';
            }
            return '';
        }

        function generateSummary() {
            const simulationDuration = Math.floor((Date.now() - simulationStartTime) / 1000);

            // Calculate tier statistics
            const tierStats = {
                'Diamond': { served: 0, totalWait: 0, maxWait: 0, minWait: Infinity, starved: 0 },
                'Gold': { served: 0, totalWait: 0, maxWait: 0, minWait: Infinity, starved: 0 },
                'Yellow': { served: 0, totalWait: 0, maxWait: 0, minWait: Infinity, starved: 0 },
                'Standard': { served: 0, totalWait: 0, maxWait: 0, minWait: Infinity, starved: 0 }
            };

            servedCustomers.forEach(customer => {
                const stats = tierStats[customer.tier];
                stats.served++;
                stats.totalWait += customer.totalWaitTime;
                stats.maxWait = Math.max(stats.maxWait, customer.totalWaitTime);
                stats.minWait = Math.min(stats.minWait, customer.totalWaitTime);

                if (customer.totalWaitTime >= WAIT_TIME_CRITICAL) {
                    stats.starved++;
                }
            });

            // Calculate average service order by tier
            const tierServiceOrder = {};
            servedCustomers.forEach((customer, index) => {
                if (!tierServiceOrder[customer.tier]) {
                    tierServiceOrder[customer.tier] = [];
                }
                tierServiceOrder[customer.tier].push(index + 1);
            });

            // Generate HTML
            let html = `
                <div class="summary-section">
                    <h3>‚è±Ô∏è Simulation Overview</h3>
                    <div class="metrics-grid">
                        <div class="metric-box">
                            <div class="metric-label">Duration</div>
                            <div class="metric-value">${formatTime(simulationDuration)}</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">Customers Added</div>
                            <div class="metric-value">${totalCustomersAdded}</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">Customers Served</div>
                            <div class="metric-value">${servedCustomers.length}</div>
                            <div class="metric-subtext">${Math.round((servedCustomers.length / totalCustomersAdded) * 100)}% completion rate</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">Still Waiting</div>
                            <div class="metric-value">${conversations.length}</div>
                        </div>
                    </div>
                </div>

                <div class="summary-section">
                    <h3>üéØ Performance by Tier</h3>
            `;

            // Add tier analysis
            Object.keys(TIER_CONFIG).forEach(tier => {
                const stats = tierStats[tier];
                const avgWait = stats.served > 0 ? Math.round(stats.totalWait / stats.served) : 0;
                const tierConfig = TIER_CONFIG[tier];
                const avgServiceOrder = tierServiceOrder[tier]
                    ? Math.round(tierServiceOrder[tier].reduce((a, b) => a + b, 0) / tierServiceOrder[tier].length)
                    : 0;

                const starvationRate = stats.served > 0 ? Math.round((stats.starved / stats.served) * 100) : 0;
                const starvationStatus = starvationRate === 0
                    ? '‚úÖ No starvation'
                    : starvationRate < 20
                        ? '‚ö†Ô∏è Low starvation'
                        : 'üö® High starvation';

                html += `
                    <div class="tier-analysis" style="border-left: 4px solid ${tier === 'Diamond' ? '#3b82f6' : tier === 'Gold' ? '#f59e0b' : tier === 'Yellow' ? '#eab308' : '#6b7280'}">
                        <div class="tier-analysis-header">
                            <span class="tier-analysis-title">${tier} Tier</span>
                            <span style="color: #666; font-size: 14px;">${stats.served} served</span>
                        </div>
                        <div class="tier-analysis-stats">
                            <div>
                                <strong>Avg Wait:</strong><br>${formatTime(avgWait)}
                            </div>
                            <div>
                                <strong>Service Order:</strong><br>#${avgServiceOrder} avg position
                            </div>
                            <div>
                                <strong>Starvation:</strong><br>${starvationStatus}
                            </div>
                        </div>
                        <div style="margin-top: 10px; font-size: 12px; color: #666;">
                            Max wait: ${formatTime(stats.maxWait === 0 ? 0 : stats.maxWait)} |
                            Min wait: ${formatTime(stats.minWait === Infinity ? 0 : stats.minWait)}
                        </div>
                    </div>
                `;
            });

            html += `</div>`;

            // Add insights
            const diamondStats = tierStats['Diamond'];
            const goldStats = tierStats['Gold'];
            const standardStats = tierStats['Standard'];
            const yellowStats = tierStats['Yellow'];

            const diamondAvg = diamondStats.served > 0 ? Math.round(diamondStats.totalWait / diamondStats.served) : 0;
            const standardAvg = standardStats.served > 0 ? Math.round(standardStats.totalWait / standardStats.served) : 0;

            html += `
                <div class="summary-section">
                    <h3>üí° Key Insights</h3>
                    <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; border-left: 4px solid #3b82f6;">
                        <strong style="color: #1e40af;">Priority Performance:</strong>
                        <ul style="margin-top: 10px; color: #1e3a8a; line-height: 1.8;">
                            ${diamondStats.served > 0 && standardStats.served > 0 && diamondAvg < standardAvg
                                ? `<li>‚úÖ Diamond customers waited ${Math.round(((standardAvg - diamondAvg) / standardAvg) * 100)}% less time than Standard customers</li>`
                                : '<li>‚ö†Ô∏è Diamond priority advantage not clearly demonstrated</li>'
                            }
                            ${goldStats.served > 0 && standardStats.served > 0 && goldStats.totalWait / goldStats.served < standardStats.totalWait / standardStats.served
                                ? '<li>‚úÖ Gold customers received priority treatment</li>'
                                : '<li>‚ÑπÔ∏è Gold tier performance similar to others</li>'
                            }
                        </ul>
                    </div>
                    <div style="background: #ecfdf5; padding: 15px; border-radius: 8px; border-left: 4px solid #10b981; margin-top: 15px;">
                        <strong style="color: #065f46;">Starvation Prevention:</strong>
                        <ul style="margin-top: 10px; color: #065f46; line-height: 1.8;">
                            ${standardStats.starved === 0
                                ? '<li>‚úÖ No Standard tier customers experienced critical wait times</li>'
                                : `<li>‚ö†Ô∏è ${standardStats.starved} Standard customers experienced critical wait times</li>`
                            }
                            ${yellowStats.starved === 0
                                ? '<li>‚úÖ No Yellow tier customers experienced critical wait times</li>'
                                : `<li>‚ö†Ô∏è ${yellowStats.starved} Yellow customers experienced critical wait times</li>`
                            }
                            ${(standardStats.starved + yellowStats.starved) === 0
                                ? '<li>‚úÖ Excellent starvation prevention - all lower tiers served timely</li>'
                                : '<li>üí° Consider adjusting score increments to reduce lower tier wait times</li>'
                            }
                        </ul>
                    </div>
                </div>
            `;

            return html;
        }

        function showSummary() {
            const summaryBody = document.getElementById('summaryBody');
            summaryBody.innerHTML = generateSummary();
            document.getElementById('summaryModal').classList.add('active');
        }

        function closeSummary() {
            document.getElementById('summaryModal').classList.remove('active');
        }

        function stopSimulation() {
            isPaused = true;
            clearInterval(simulationInterval);
            clearInterval(agentAssignmentInterval);
            showSummary();
        }

        function applyBalancedConfiguration() {
            // Apply strong priority configuration (original)
            document.getElementById('timeInterval').value = 10;
            document.getElementById('diamondBase').value = 0;
            document.getElementById('diamondIncrease').value = 15;
            document.getElementById('goldBase').value = 0;
            document.getElementById('goldIncrease').value = 11;
            document.getElementById('yellowBase').value = 0;
            document.getElementById('yellowIncrease').value = 7;
            document.getElementById('standardBase').value = 0;
            document.getElementById('standardIncrease').value = 5;

            applyConfiguration();
            alert('‚úÖ Strong Priority Config Applied!\n\nDiamond: +15/10s, Gold: +11/10s, Yellow: +7/10s, Standard: +5/10s\n\n3x Diamond advantage (15 vs 5)\n‚Ä¢ Maximum showcase of Diamond priority power\n‚Ä¢ Diamond ~57% faster than Standard\n‚Ä¢ May have some lower tier starvation\n\nRun the scenario to test!');
        }

        function applyOptionA() {
            // Apply Option A configuration - optimal Diamond priority with zero starvation
            document.getElementById('timeInterval').value = 10;
            document.getElementById('diamondBase').value = 0;
            document.getElementById('diamondIncrease').value = 15;
            document.getElementById('goldBase').value = 0;
            document.getElementById('goldIncrease').value = 11;
            document.getElementById('yellowBase').value = 0;
            document.getElementById('yellowIncrease').value = 9;
            document.getElementById('standardBase').value = 0;
            document.getElementById('standardIncrease').value = 8;

            applyConfiguration();
            alert('‚úÖ Option A Config Applied! (Recommended)\n\nDiamond: +15/10s, Gold: +11/10s, Yellow: +9/10s, Standard: +8/10s\n\n1.875x Diamond advantage (15 vs 8)\n‚Ä¢ Diamond ~48-50% faster than Standard\n‚Ä¢ Agent assignment every 10 seconds\n‚Ä¢ Zero critical starvation across all tiers\n‚Ä¢ Optimal balance of power showcase + fairness\n\nRun the scenario to test!');
        }

        function applyCustomConfiguration() {
            // Apply whatever values are currently in the config input fields
            applyConfiguration();

            const diamondInc = document.getElementById('diamondIncrease').value;
            const goldInc = document.getElementById('goldIncrease').value;
            const yellowInc = document.getElementById('yellowIncrease').value;
            const standardInc = document.getElementById('standardIncrease').value;
            const interval = document.getElementById('timeInterval').value;

            alert(`‚úÖ Custom Configuration Applied!\n\nDiamond: +${diamondInc}/${interval}s\nGold: +${goldInc}/${interval}s\nYellow: +${yellowInc}/${interval}s\nStandard: +${standardInc}/${interval}s\n\nYour custom settings are now active.\n\nRun the scenario to test your configuration!`);
        }

        function runBalancedScenario() {
            if (scenarioRunning) return;

            // Reset everything first
            conversations = [];
            conversationIdCounter = 1;
            servedCustomers = [];
            simulationStartTime = Date.now();
            totalCustomersAdded = 0;
            isPaused = false;
            document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è Pause Simulation';
            document.getElementById('pauseBtn').style.background = '#f59e0b';
            renderQueues();

            // Apply balanced config
            applyBalancedConfiguration();

            scenarioRunning = true;
            document.getElementById('scenarioProgress').classList.add('active');
            document.getElementById('runBalancedScenario').style.display = 'none';
            document.getElementById('stopScenarioBtn').style.display = 'inline-block';

            // Define scenario timeline - ALL customers go to Q1 for focused demonstration
            scenarioSteps = [
                // Phase 1: Standard customers arrive first (0-20s)
                { time: 0, tier: 'Standard', queue: 'Q1', message: 'Q1: Standard customer #1 arrives (early arrival)' },
                { time: 5, tier: 'Standard', queue: 'Q1', message: 'Q1: Standard customer #2 arrives' },
                { time: 10, tier: 'Standard', queue: 'Q1', message: 'Q1: Standard customer #3 arrives' },
                { time: 15, tier: 'Yellow', queue: 'Q1', message: 'Q1: Yellow customer #1 arrives' },
                { time: 18, tier: 'Standard', queue: 'Q1', message: 'Q1: Standard customer #4 arrives' },

                // Phase 2: Gold tier arrives (20-35s)
                { time: 22, tier: 'Gold', queue: 'Q1', message: 'Q1: Gold customer #1 arrives' },
                { time: 28, tier: 'Standard', queue: 'Q1', message: 'Q1: Standard customer #5 arrives' },
                { time: 32, tier: 'Yellow', queue: 'Q1', message: 'Q1: Yellow customer #2 arrives' },
                { time: 35, tier: 'Gold', queue: 'Q1', message: 'Q1: Gold customer #2 arrives' },

                // Phase 3: Diamond customers arrive LATE (40-55s) - they arrive late but should still get priority!
                { time: 40, tier: 'Diamond', queue: 'Q1', message: 'Q1: üíé Diamond customer #1 arrives (late but VIP!)' },
                { time: 45, tier: 'Standard', queue: 'Q1', message: 'Q1: Standard customer #6 arrives' },
                { time: 48, tier: 'Diamond', queue: 'Q1', message: 'Q1: üíé Diamond customer #2 arrives (late but VIP!)' },
                { time: 52, tier: 'Yellow', queue: 'Q1', message: 'Q1: Yellow customer #3 arrives' },
                { time: 55, tier: 'Diamond', queue: 'Q1', message: 'Q1: üíé Diamond customer #3 arrives (late but VIP!)' },

                // Phase 4: Continued mix (60-75s)
                { time: 60, tier: 'Standard', queue: 'Q1', message: 'Q1: Standard customer #7 arrives' },
                { time: 65, tier: 'Gold', queue: 'Q1', message: 'Q1: Gold customer #3 arrives' },
                { time: 70, tier: 'Yellow', queue: 'Q1', message: 'Q1: Yellow customer #4 arrives' },
                { time: 72, tier: 'Standard', queue: 'Q1', message: 'Q1: Standard customer #8 arrives' },

                // Phase 5: Final late Diamond to stress test (80-90s)
                { time: 80, tier: 'Diamond', queue: 'Q1', message: 'Q1: üíé Diamond customer #4 arrives (very late!)' },
                { time: 85, tier: 'Standard', queue: 'Q1', message: 'Q1: Standard customer #9 arrives' },
                { time: 88, tier: 'Gold', queue: 'Q1', message: 'Q1: Gold customer #4 arrives' },

                // End scenario
                { time: 95, tier: null, queue: null, message: '‚úÖ Scenario complete! All 22 customers added to Q1. Watch the queue and wait 60s more, then click "Stop & Show Summary".' }
            ];

            executeScenarioStep(0);
        }

        function executeScenarioStep(stepIndex) {
            if (!scenarioRunning || stepIndex >= scenarioSteps.length) {
                if (scenarioRunning) {
                    completeScenario();
                }
                return;
            }

            const step = scenarioSteps[stepIndex];
            const delay = stepIndex === 0 ? 0 : (scenarioSteps[stepIndex].time - scenarioSteps[stepIndex - 1].time) * 1000;

            scenarioTimeout = setTimeout(() => {
                if (!scenarioRunning) return;

                // Update progress
                const progress = Math.round((stepIndex / scenarioSteps.length) * 100);
                document.getElementById('progressFill').style.width = progress + '%';
                document.getElementById('scenarioStatus').textContent = step.message;

                // Add customer if not the end step
                if (step.tier && step.queue) {
                    addConversation(step.queue, step.tier, false);
                }

                // Move to next step
                executeScenarioStep(stepIndex + 1);
            }, delay);
        }

        function completeScenario() {
            scenarioRunning = false;
            document.getElementById('progressFill').style.width = '100%';
            document.getElementById('scenarioStatus').innerHTML = '<strong>‚úÖ Scenario Complete!</strong> 22 customers added to Queue 1. Watch them get served (auto-assignment every 10s). Wait 60-90 seconds, then click "Stop & Show Summary" to analyze: Did Diamonds get priority? Were Standards starved?';
            document.getElementById('runBalancedScenario').style.display = 'inline-block';
            document.getElementById('stopScenarioBtn').style.display = 'none';
        }

        function stopScenario() {
            scenarioRunning = false;
            if (scenarioTimeout) {
                clearTimeout(scenarioTimeout);
            }
            document.getElementById('scenarioProgress').classList.remove('active');
            document.getElementById('runBalancedScenario').style.display = 'inline-block';
            document.getElementById('stopScenarioBtn').style.display = 'none';
            document.getElementById('progressFill').style.width = '0%';
        }

        function renderQueues() {
            const queues = { Q1: [], Q2: [], Q3: [] };

            // Group conversations by queue
            conversations.forEach(conv => {
                if (queues[conv.queue]) {
                    queues[conv.queue].push(conv);
                }
            });

            // Sort Q1 and Q2 by priority (highest first), Q3 by FIFO (earliest first)
            queues.Q1.sort((a, b) => b.priorityScore - a.priorityScore);
            queues.Q2.sort((a, b) => b.priorityScore - a.priorityScore);
            queues.Q3.sort((a, b) => a.arrivalOrder - b.arrivalOrder);

            // Render each queue
            Object.keys(queues).forEach(queueName => {
                const queueContent = document.getElementById(`${queueName.toLowerCase()}-content`);
                const queueConversations = queues[queueName];
                const isFifo = queueName === 'Q3';

                // Update count
                const queueElement = document.getElementById(queueName.toLowerCase());
                const countElement = queueElement.querySelector('.queue-count');
                countElement.textContent = `${queueConversations.length} waiting`;

                // Render conversations
                queueContent.innerHTML = queueConversations.map((conv, index) => {
                    const tierConfig = TIER_CONFIG[conv.tier];
                    const starvationClass = getStarvationClass(conv.waitTime);
                    const starvationIndicator = getStarvationIndicator(conv.waitTime);

                    return `
                        <div class="conversation ${tierConfig.class} ${starvationClass}" data-id="${conv.id}">
                            <div class="conversation-header">
                                <div class="customer-info">
                                    <span class="customer-name">${conv.customerName}</span>
                                    <span class="tier-badge ${tierConfig.class}">${conv.tier}</span>
                                    ${starvationIndicator}
                                </div>
                                ${isFifo
                                    ? `<span class="fifo-position">#${index + 1}</span>`
                                    : `<span class="priority-score">${conv.priorityScore}</span>`
                                }
                            </div>
                            <div class="conversation-details">
                                <div class="detail-item">
                                    <span class="detail-label">Subject</span>
                                    <span class="detail-value">${conv.subject}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Wait Time</span>
                                    <span class="detail-value">${formatTime(conv.waitTime)}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Queue</span>
                                    <span class="detail-value">${conv.queue}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">${isFifo ? 'Queue Logic' : 'Priority Increment'}</span>
                                    <span class="detail-value">${isFifo ? 'First In First Out' : `+${tierConfig.multiplier}/${TIME_INTERVAL}s`}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            });

            // Update statistics
            updateStatistics();
        }

        function applyConfiguration() {
            // Update time interval
            TIME_INTERVAL = parseInt(document.getElementById('timeInterval').value) || 10;

            // Update tier configurations
            TIER_CONFIG.Diamond.basePriority = parseInt(document.getElementById('diamondBase').value);
            if (isNaN(TIER_CONFIG.Diamond.basePriority)) TIER_CONFIG.Diamond.basePriority = 0;
            TIER_CONFIG.Diamond.multiplier = parseInt(document.getElementById('diamondIncrease').value) || 15;

            TIER_CONFIG.Gold.basePriority = parseInt(document.getElementById('goldBase').value);
            if (isNaN(TIER_CONFIG.Gold.basePriority)) TIER_CONFIG.Gold.basePriority = 0;
            TIER_CONFIG.Gold.multiplier = parseInt(document.getElementById('goldIncrease').value) || 11;

            TIER_CONFIG.Yellow.basePriority = parseInt(document.getElementById('yellowBase').value);
            if (isNaN(TIER_CONFIG.Yellow.basePriority)) TIER_CONFIG.Yellow.basePriority = 0;
            TIER_CONFIG.Yellow.multiplier = parseInt(document.getElementById('yellowIncrease').value) || 9;

            TIER_CONFIG.Standard.basePriority = parseInt(document.getElementById('standardBase').value);
            if (isNaN(TIER_CONFIG.Standard.basePriority)) TIER_CONFIG.Standard.basePriority = 0;
            TIER_CONFIG.Standard.multiplier = parseInt(document.getElementById('standardIncrease').value) || 8;

            // Recalculate all priority scores
            conversations.forEach(conv => {
                if (conv.queue !== 'Q3') {
                    conv.priorityScore = calculatePriorityScore(conv);
                }
            });

            // Update legend
            updateLegend();
            renderQueues();
        }

        function updateLegend() {
            const legendItems = [
                { tier: 'Diamond', config: TIER_CONFIG.Diamond },
                { tier: 'Gold', config: TIER_CONFIG.Gold },
                { tier: 'Yellow', config: TIER_CONFIG.Yellow },
                { tier: 'Standard', config: TIER_CONFIG.Standard }
            ];

            const legendGrid = document.getElementById('legendGrid');
            legendGrid.innerHTML = legendItems.map(item => `
                <div class="legend-item">
                    <div class="legend-color ${item.config.class}"></div>
                    <div class="legend-text">
                        <div class="legend-title">${item.tier} Tier</div>
                        <div class="legend-desc">+${item.config.multiplier} points per ${TIME_INTERVAL}s</div>
                    </div>
                </div>
            `).join('');
        }

        // Event handlers
        document.getElementById('pauseBtn').addEventListener('click', function() {
            isPaused = !isPaused;
            this.textContent = isPaused ? '‚ñ∂Ô∏è Resume Simulation' : '‚è∏Ô∏è Pause Simulation';
            this.style.background = isPaused ? '#10b981' : '#f59e0b';
        });

        document.getElementById('addCustomerBtn').addEventListener('click', function() {
            const selectedQueue = document.getElementById('selectQueue').value;
            const selectedTier = document.getElementById('selectTier').value;
            addConversation(selectedQueue, selectedTier);
        });

        document.getElementById('addRandomBtn').addEventListener('click', function() {
            const queues = ['Q1', 'Q2', 'Q3'];
            const tiers = ['Diamond', 'Gold', 'Yellow', 'Standard'];
            const randomQueue = queues[Math.floor(Math.random() * queues.length)];
            const randomTier = tiers[Math.floor(Math.random() * tiers.length)];
            addConversation(randomQueue, randomTier);
        });

        document.getElementById('clearAllBtn').addEventListener('click', function() {
            if (confirm('Are you sure you want to clear all conversations from all queues? This will also reset simulation tracking.')) {
                conversations = [];
                servedCustomers = [];
                simulationStartTime = Date.now();
                totalCustomersAdded = 0;
                renderQueues();
            }
        });

        document.getElementById('resetBtn').addEventListener('click', function() {
            conversations = [];
            conversationIdCounter = 1;
            servedCustomers = [];
            simulationStartTime = Date.now();
            totalCustomersAdded = 0;
            isPaused = false;
            document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è Pause Simulation';
            document.getElementById('pauseBtn').style.background = '#f59e0b';
            initializeConversations();
        });

        document.getElementById('stopSimulationBtn').addEventListener('click', function() {
            stopSimulation();
        });

        document.getElementById('closeSummaryBtn').addEventListener('click', function() {
            closeSummary();
        });

        document.getElementById('applyBalancedConfig').addEventListener('click', function() {
            applyBalancedConfiguration();
        });

        document.getElementById('applyOptionA').addEventListener('click', function() {
            applyOptionA();
        });

        document.getElementById('applyCustomConfig').addEventListener('click', function() {
            applyCustomConfiguration();
        });

        document.getElementById('runBalancedScenario').addEventListener('click', function() {
            runBalancedScenario();
        });

        document.getElementById('stopScenarioBtn').addEventListener('click', function() {
            stopScenario();
        });

        // Start simulation
        initializeConversations();
        updateLegend();
        simulationInterval = setInterval(updateConversations, 1000);
        agentAssignmentInterval = setInterval(assignToAgent, 10000); // Assign customers every 10 seconds
    </script>
</body>
</html>
